# 🎯 Pi-Friends AI 가이드

**중요**: Claude는 항상 한국어로 응답

## 🚀 Command 시스템

```bash
/task:new      # 새 작업 PLAN.md 작성 (실행X)
/task:resume   # 기존 작업 불러와서 진행
/task:complete # 완료 + Knowledge 저장
/task:knowledge # Knowledge 관리
```

**작업 흐름**: 
- **새 작업**: 요청 → /task:new → 승인 → 실행 → /task:complete
- **기존 작업**: /task:resume → 실행 → /task:complete

## 🎯 핵심 협업 원칙

### 모델링 단계 강화
**"모델링 = 구현 전 가장 중요한 합의 지점"**

- Phase 0 (모델링)에서는 반드시 **상세한 핑퐁 진행**
- 데이터 구조, 비즈니스 로직, API 설계를 충분히 논의
- 구현 시작 전 모든 핵심 결정사항 합의 완료
- 빠른 진행보다 **정확한 이해와 합의**가 우선



## ⚡ 실시간 작업 플로우

### 작업 루프 (자동 반복)
PLAN.md에 [ ] 항목이 있는 동안 계속 반복:
1. 다음 [ ] 항목 찾기
2. 해당 줄을 [~]로 변경
3. PROGRESS.md에 "🚀 시작" 기록 (아래 형식 필수)
4. 실제 작업 수행
5. 해당 줄을 [x]로 변경
6. PROGRESS.md에 "✅ 완료" 기록 (아래 형식 필수)
7. 1번으로 돌아가서 다음 작업 진행

### Phase 완료 시
- "Phase 1 완료! Phase 2 시작할까요?" 같은 메시지 표시
- 사용자가 "진행" 하면 다음 Phase 시작

### 체크박스 상태 & 필수 규칙
- `[ ]` **대기중**: 아직 시작 안함
- `[~]` **진행중**: 작업 시작 시 변경 + PROGRESS.md에 "🚀 시작" 기록
- `[x]` **완료됨**: 작업 완료 시 변경 + PROGRESS.md에 "✅ 완료" 기록

### 선택적 업데이트 시점
- **에러/이슈 발생 시**: 문제 상황과 해결 과정 기록
- **중요 결정 시**: 방향 전환이나 선택 사항 기록
- **30분+ 긴 작업**: 중간 진행 상황 기록

## 🤖 서브 에이전트 자동 할당

```yaml
database_engineer: 테이블/스키마/마이그레이션/RLS/SQL
backend_developer: API/비즈니스로직/TDD/도메인/usecase  
frontend_developer: UI/Svelte/반응형/컴포넌트/Store
reward_designer: Pi/Coin/보상/인센티브/게임경제
```

**서브 에이전트 호출 시 필수 전달 사항**:
- 위 "⚡ 실시간 작업 플로우" 전체 내용 전달
- "PLAN.md 체크박스 상태 변경(`[ ]`→`[~]`→`[x]`) 잊지 마세요" 리마인드
- PLAN.md와 PROGRESS.md 확인 후 작업 시작하도록 지시

## 🤖 서브 에이전트 필수 작업 순서

### 작업 받으면:
1. PLAN.md 읽어서 현재 Phase 확인
2. PROGRESS.md 읽어서 진행 상황 확인
3. Phase의 각 [ ] 항목마다:
   - [~]로 변경
   - PROGRESS.md "🚀 시작" 기록 (계획/접근법/예상결과 포함)
   - 실제 작업 수행
   - [x]로 변경
   - PROGRESS.md "✅ 완료" 기록 (결과/인사이트/파일/특이사항 포함)
   - 다음 항목으로 자동 이동
4. Phase 완료되면 메인 Claude에게 보고

## 📝 PROGRESS.md 기록 지침

### 기록 형식

#### 시작 시:
```markdown
### [시간] 🚀 시작: [작업명]
- 계획: 어떤 방향으로 작업할 것인지
- 접근법: 어떤 방식으로 구현할 것인지
- 예상 결과: 무엇을 만들/수정할 것인지
```

#### 완료 시:
```markdown
### [시간] ✅ 완료: [작업명]
- 결과: 실제로 무엇을 했는지
- 인사이트: 작업 중 발견한 중요한 점
- 생성/수정 파일: 어떤 파일들이 변경되었는지
- 특이사항: 추가로 알아야 할 정보
```

### 구조
```markdown
# Progress Log: [작업명]

## 🎯 현재 상황
**진행중인 작업**: [~] 표시된 작업명
**완료된 작업**: [x] 표시된 작업 개수
**남은 작업**: [ ] 표시된 작업 개수

## 📋 작업 로그 (시간순, 최신이 아래)
### [14:30] 🚀 시작: 테이블 스키마 작성
- 계획: users, posts 테이블 설계 예정
- 접근법: database.md 패턴 적용
- 예상 결과: 2개 테이블 생성

### [14:45] ✅ 완료: 테이블 스키마 작성
- 결과: users(5개 컬럼), posts(8개 컬럼) 생성
- 인사이트: 필수 컬럼 패턴으로 일관성 확보
- 생성/수정 파일: migrations/001_initial.sql
- 특이사항: created_at 인덱스 추가
```

**목적**: ①진행 상태 추적 ②작업 이력 기록 ③task:resume 시 정확한 위치 파악

## 🔌 MCP 도구 (AI 판단 품질 향상)

### Gemini CLI
**사용 시기**: 대규모 분석, 복잡한 버그, 성능 최적화 (200k 토큰 컨텍스트)

### Sequential Thinking  
**사용 시기**: PLAN.md 작성, 복잡한 작업 분해, 위험 관리 계획
- 큰 목표 → 마일스톤 → 태스크 → 서브태스크 순서로 분해
- "A 실패 시 → B 플랜 → C 플랜" 형식 위험 관리

## 📚 Knowledge 시스템 (AI 학습 품질 향상)

### 패턴 분류
- **CORE**: 10회+ 사용 (자동 적용)  
- **VERIFIED**: 3-9회 사용 (검증됨)
- **REVIEW**: 0-2회 사용 (검토 필요)

### 저장 규칙
- **새 패턴**: `/docs/knowledge/patterns/REVIEW/` 저장
- **승격**: 3회→VERIFIED, 10회→CORE
- **필수**: 작업 완료 후 패턴 추출 및 저장

## 🔧 개발 명령어 (참고)
```bash
# Supabase
sbganer migration new {feature}
sbganer migration up
supabase gen types typescript --local > web/src/lib/supabase/schema.gen.ts

# Web/Flutter
pnpm test && pnpm run dev
flutter run && flutter test
```

## 🚫 절대 금지사항
- ❌ `/task:new`에서 실행 (계획만)
- ❌ 메인 Claude 직접 코드 작성
- ❌ PLAN.md/PROGRESS.md 확인 없이 작업 시작
- ❌ 작업 시작 시 `[~]` 마킹 누락
- ❌ 작업 완료 시 `[x]` 변경 누락
- ❌ PROGRESS.md 시작/완료 로그 누락
- ❌ **여러 항목 동시 변경 (한 번에 하나씩만)**
- ❌ **실제 작업 없이 체크 표시**
- ❌ **순서 건너뛰기**
- ❌ **PROGRESS.md 형식 무시**
- ❌ **TodoWrite 도구 사용 금지**

### 🔥 강화된 금지 규칙
- ❌ **기존 완성 작업 발견 시 과정 생략 절대 금지**
- ❌ **"이미 있으니까 빠르게 처리" 사고방식 금지**
- ❌ **효율성을 이유로 한 규칙 무시 절대 금지**

### 💡 완성 작업 발견 시 올바른 처리법
1. **발견 기록**: PROGRESS.md에 "[시간] 📋 발견: 기존 완성된 [작업명]" 기록
2. **검증 과정**: 실제 내용 확인 후 "검증 완료" 기록
3. **정식 완료**: 검증 후에만 PLAN.md [x] 변경 및 완료 로그 작성

## 📝 자동 문서화 시스템

### /task:complete 시 SUMMARY.md 생성
**작업 완료 시 자동으로 개발 관점 요약 문서 생성**

#### 생성 위치
```
docs/tasks/{task-name}/SUMMARY.md
```

#### 포함 내용
1. **데이터베이스 변경사항**: 테이블, 스키마, 마이그레이션
2. **타입 시스템**: 새 타입, enum, interface, 사용법
3. **도메인 로직**: 비즈니스 로직, 알고리즘, 패턴
4. **API 아키텍처**: 엔드포인트, 클라이언트, 응답 구조
5. **보안/무결성**: RLS, 트랜잭션, 검증 로직
6. **테스트 전략**: 단위 테스트, 통합 테스트, 커버리지
7. **개발 관점 우수 사례**: 패턴, 확장성, 재사용성

#### 제외 사항
- UI 컴포넌트 세부 구현
- 스타일링 관련 내용
- 애니메이션 구현 세부사항

#### 생성 시점
`/task:complete` 명령 실행 시 knowledge 추출과 함께 자동 생성

## 🔥 핵심 원칙
1. **사용자 지시 절대 우선**
2. **PLAN.md가 진실의 소스**: 모든 작업 상태는 PLAN.md 체크박스 기준
3. **작업 플로우 준수**: 시작(`[~]`+로그) → 진행 → 완료(`[x]`+로그)
4. **메인 Claude**: 조율/계획, **서브 에이전트**: 구현
5. **PROGRESS.md로 상세 추적**: 시작/완료 시간과 결과 필수 기록
6. **TodoWrite 사용 금지**: PLAN.md + PROGRESS.md만 사용
7. **자동 문서화**: 작업 완료 시 SUMMARY.md 자동 생성